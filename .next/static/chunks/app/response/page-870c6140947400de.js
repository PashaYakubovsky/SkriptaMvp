(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[168],{8340:function(e,t,s){Promise.resolve().then(s.bind(s,2124))},2124:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return _}});var a=s(7437),r=s(2655),n=s.n(r),i=s(6526),l=s.n(i),o=s(2126),c=s(2265),d=s(8726),u=s(7650),h=s(762),f=s(3237),g=s(6463),p=s(1987),y=s(994),m=s(2800),x=s(133),w=s(9099);let v=(0,s(7818).default)(()=>Promise.all([s.e(247),s.e(704)]).then(s.bind(s,4704)),{loadableGenerated:{webpack:()=>[4704]},ssr:!1}),I=(0,w.Ue)(()=>({history:[],loading:!1,_history:[],refreshId:null,refreshLoading:!1})),b=async e=>{let t=e.filter(e=>"user"!==e.role&&"system"!==e.role&&"You are a film scenario creation AI assistant."!==e.content);for(let e=0;e<t.length;e++){let s=await (0,p.C)(t[e].content),a=(0,y.S)(s);t[e].html=a}return t};function _(){let e=(0,g.useRouter)(),t=(0,c.useCallback)(e=>{"function"==typeof e?I.setState(e):I.setState({...I.getState(),...e})},[]),s=I(e=>e.history),r=I(e=>e.loading),i=I(e=>e._history),p=I(e=>e.refreshId),y=I(e=>e.refreshLoading),w=(0,g.useSearchParams)(),_=(0,c.useMemo)(()=>{var e;return null!==(e=null==w?void 0:w.get("seriesId"))&&void 0!==e?e:""},[w]);(0,c.useEffect)(()=>{(async()=>{if(!r){t({loading:!0});try{var s;let a=w&&null!==(s=w.get("seriesId"))&&void 0!==s?s:"new",r=localStorage.getItem("userId"),n=(await o.Z.get("/api/series/".concat(a,"?userId=").concat(r))).data,i=n.data.history;n.new&&(e.replace("/response?seriesId=".concat(n.data.id)),i=(await (0,m.k)({history:i,seriesId:n.data.id,message:{role:"system",content:"Create synopsis for whole series with specific details.",id:Math.random().toString()}})).series.history);let l=i,c=await b(i);t({history:c,_history:l,loading:!1})}catch(e){t({loading:!1}),console.error(e),d.ZP.error("Failed to fetch data")}}})()},[]);let N=(0,c.useCallback)(async()=>{t({loading:!0});try{let e=await (0,m.k)({history:i,seriesId:_}),a=await b(s);t({history:a,_history:e.series.history,loading:!1}),d.ZP.success("New episode created")}catch(e){console.error(e),t({loading:!1})}},[i,_]),k=(0,c.useCallback)(async()=>{t({refreshLoading:!1});let e=localStorage.getItem("userId"),s=(await o.Z.get("/api/series/".concat(_,"?userId=").concat(e))).data.data.history,a=await b(s);t(e=>({...e,history:a,_history:s,loading:!1,refreshId:null,refreshLoading:!1}))},[_]);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("main",{className:"flex min-h-screen flex-col items-start flex-start mb-[2rem] gap-5",children:[(0,a.jsx)("header",{id:"header",className:"h-[90px] bg-[#000] text-lg pt-[3rem] w-full text-center text-white relative",children:(0,a.jsx)(u.Z,{h2:!0,className:"relative z-10 px-4",children:"Here you go..."})}),(0,a.jsxs)("div",{className:"flex flex-col gap-5 px-4 xl:max-w-[1200px] m-auto h-full",children:[s.map(async(e,s)=>{var r,i;return(0,a.jsxs)(h.Z,{className:"p-4 relative z-10 my-2",children:[(0,a.jsx)("h3",{className:"font-bold",children:0===s?"Synopsys":"Episode ".concat(s)}),(0,a.jsx)("p",{className:"text-lg ".concat(n().className," ").concat(l().episode),dangerouslySetInnerHTML:{__html:null!==(r=null==e?void 0:e.html)&&void 0!==r?r:""}}),(0,a.jsx)(x.lgS,{className:"w-4 h-4 ".concat(y&&p===(null==e?void 0:e.id)?"animate-spin":""," absolute right-4 top-4 cursor-pointer"),onClick:()=>{t(t=>({...t,refreshId:null==e?void 0:e.id,refreshLoading:!0}))},title:0===s?"Refresh synopsys":"Refresh episode "+s})]},null!==(i=null==e?void 0:e.id)&&void 0!==i?i:s)}),(0,a.jsx)(f.Z,{loading:r,type:"secondary",onClick:N,className:"rounded-lg p-2 bg-indigo-600 text-zinc-100 active:scale-125 transition-all hover:bg-indigo-800",children:"Generate new episode"})]})]}),(0,a.jsx)(v,{close:()=>t({refreshId:null}),refreshId:null!=p?p:"",open:null!==p,scriptId:_,onUpdate:k})]})}},2800:function(e,t,s){"use strict";s.d(t,{g:function(){return n},k:function(){return r}});var a=s(2126);let r=async e=>{let{history:t,seriesId:s,message:r}=e,n=[...t,null!=r?r:{role:"user",content:"Create new episode"}];return(await a.Z.post("/api/series/".concat(s),{history:n})).data},n=async e=>{let{userId:t}=e;try{return(await a.Z.get("/api/series?userId="+t)).data.data}catch(e){return console.error(e),[]}}},6526:function(e){e.exports={episode:"page_episode__IabRJ"}}},function(e){e.O(0,[318,422,643,806,826,726,126,276,620,971,23,744],function(){return e(e.s=8340)}),_N_E=e.O()}]);