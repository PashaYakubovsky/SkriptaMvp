(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[168],{8340:function(e,t,s){Promise.resolve().then(s.bind(s,2124))},2124:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var r=s(7437),a=s(2655),n=s.n(a),i=s(6526),o=s.n(i),l=s(2126),c=s(2265),d=s(8726),u=s(7650),h=s(762),f=s(3237),g=s(6463),p=s(1987),m=s(994),y=s(2800),x=s(133),I=s(9099);let v=(0,s(7818).default)(()=>Promise.all([s.e(247),s.e(704)]).then(s.bind(s,4704)),{loadableGenerated:{webpack:()=>[4704]},ssr:!1}),w=(0,I.Ue)(()=>({history:[],loading:!1,_history:[],refreshId:null,refreshLoading:!1}));function b(){let e=(0,g.useRouter)(),t=w(e=>e.history),s=(0,c.useCallback)(e=>{"function"==typeof e?w.setState(e):w.setState({...w.getState(),...e})},[]),a=w(e=>e.loading),i=w(e=>e._history),I=w(e=>e.refreshId),b=w(e=>e.refreshLoading),_=(0,g.useSearchParams)(),N=(0,c.useMemo)(()=>{var e;return null!==(e=null==_?void 0:_.get("seriesId"))&&void 0!==e?e:""},[_]);(0,c.useEffect)(()=>{(async()=>{if(!a){s({loading:!0});try{var t;let r=_&&null!==(t=_.get("seriesId"))&&void 0!==t?t:"new",a=localStorage.getItem("userId"),n=(await l.Z.get("/api/series/".concat(r,"?userId=").concat(a))).data,i=n.data.history;n.new&&(e.replace("/response?seriesId=".concat(n.data.id)),i=(await (0,y.k)({history:i,seriesId:n.data.id,message:{role:"system",content:"Create synopsis for whole series with specific details.",id:Math.random().toString()}})).series.history);let o=i,c=i.filter(e=>"user"!==e.role&&"system"!==e.role&&"You are a film scenario creation AI assistant."!==e.content);for(let e=0;e<c.length;e++){let t=await (0,p.C)(c[e].content),s=(0,m.S)(t);c[e].html=s}s({history:c,_history:o,loading:!1})}catch(e){s({loading:!1}),console.error(e),d.ZP.error("Failed to fetch data")}}})()},[]);let k=(0,c.useCallback)(async()=>{s({loading:!0});try{let e=await (0,y.k)({history:i,seriesId:N}),t=e.series.history.filter(e=>"user"!==e.role&&"system"!==e.role&&"You are a film scenario creation AI assistant."!==e.content);for(let e=0;e<t.length;e++){let s=await (0,p.C)(t[e].content),r=(0,m.S)(s);t[e].html=r}s({history:t,_history:e.series.history,loading:!1}),d.ZP.success("New episode created")}catch(e){console.error(e),s({loading:!1})}},[i,N]),S=(0,c.useCallback)(async()=>{s({refreshLoading:!1});let e=localStorage.getItem("userId"),t=(await l.Z.get("/api/series/".concat(N,"?userId=").concat(e))).data.data.history,r=t.filter(e=>"user"!==e.role&&"system"!==e.role&&"You are a film scenario creation AI assistant."!==e.content);s(e=>({...e,history:r,_history:t,loading:!1,refreshId:null,refreshLoading:!1}))},[N]);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("main",{className:"flex min-h-screen flex-col items-start flex-start mb-[2rem] gap-5",children:[(0,r.jsx)("header",{id:"header",className:"h-[90px] bg-[#000] text-lg pt-[3rem] w-full text-center text-white relative",children:(0,r.jsx)(u.Z,{h2:!0,className:"relative z-10 px-4",children:"Here you go..."})}),(0,r.jsxs)("div",{className:"flex flex-col gap-5 px-4 xl:max-w-[1200px] m-auto h-full",children:[t.map(async(e,t)=>{var a,i;return(0,r.jsxs)(h.Z,{className:"p-4 relative z-10 my-2",children:[(0,r.jsx)("h3",{className:"font-bold",children:0===t?"Synopsys":"Episode ".concat(t)}),(0,r.jsx)("p",{className:"text-lg ".concat(n().className," ").concat(o().episode),dangerouslySetInnerHTML:{__html:null!==(a=null==e?void 0:e.html)&&void 0!==a?a:""}}),(0,r.jsx)(x.lgS,{className:"w-4 h-4 ".concat(b&&I===(null==e?void 0:e.id)?"animate-spin":""," absolute right-4 top-4 cursor-pointer"),onClick:()=>{s(t=>({...t,refreshId:null==e?void 0:e.id,refreshLoading:!0}))},title:0===t?"Refresh synopsys":"Refresh episode "+t})]},null!==(i=null==e?void 0:e.id)&&void 0!==i?i:t)}),(0,r.jsx)(f.Z,{loading:a,type:"secondary",onClick:k,className:"rounded-lg p-2 bg-indigo-600 text-zinc-100 active:scale-125 transition-all hover:bg-indigo-800",children:"Generate new episode"})]})]}),(0,r.jsx)(v,{close:()=>s({refreshId:null}),refreshId:null!=I?I:"",open:null!==I,scriptId:N,onUpdate:S})]})}},2800:function(e,t,s){"use strict";s.d(t,{g:function(){return n},k:function(){return a}});var r=s(2126);let a=async e=>{let{history:t,seriesId:s,message:a}=e,n=[...t,null!=a?a:{role:"user",content:"Create new episode"}];return(await r.Z.post("/api/series/".concat(s),{history:n})).data},n=async e=>{let{userId:t}=e;try{return(await r.Z.get("/api/series?userId="+t)).data.data}catch(e){return console.error(e),[]}}},6526:function(e){e.exports={episode:"page_episode__IabRJ"}}},function(e){e.O(0,[318,422,643,806,826,726,126,276,620,971,23,744],function(){return e(e.s=8340)}),_N_E=e.O()}]);