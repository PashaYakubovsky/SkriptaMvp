"use strict";(()=>{var e={};e.id=942,e.ids=[942],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},1465:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>q,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{POST:()=>d});var a=r(49303),i=r(88716),n=r(60670),o=r(93330),u=r(25493),p=r(87070),c=r(42336);async function d(e){try{await (0,u.Z)();let t=await e.json();if(!t.accessToken)return p.NextResponse.json({message:"Unauthorized"},{status:c.WE.Unauthorized});let r=await o.Z.findOne({email:t.email});if(r)return r.lastLogin=new Date().toISOString(),await r.save(),p.NextResponse.json({message:"User already exists"},{status:c.WE.Ok});let s=await o.Z.create({email:t.email,name:t.name,picture:t.picture,accessToken:t.accessToken});return s.lastLogin=new Date().toISOString(),await s.save(),p.NextResponse.json({data:{user:s},message:"User created"},{status:c.WE.Created})}catch(e){return p.NextResponse.json({message:e},{status:c.WE.BadRequest})}}let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/save/route",pathname:"/api/auth/save",filename:"route",bundlePath:"app/api/auth/save/route"},resolvedPagePath:"/Users/pashayakubovsky/Desktop/skripta/src/app/api/auth/save/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:x}=l,h="/api/auth/save/route";function q(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:v})}},93330:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(11185);let a=new s.Schema({name:{type:String,required:!1},email:{type:String,required:!0,unique:!0},passwordHash:{type:String,required:!1},lastLogin:{type:String,required:!1},picture:{type:String,required:!1},accessToken:{type:String,required:!1}},{timestamps:!0,toJSON:{versionKey:!1,virtuals:!0,transform:(e,t)=>{delete t._id}}}),i=s.models.User||(0,s.model)("User",a)},25493:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(11185),a=r.n(s);let i=process.env.MONGO_URI,n={},o=async function(){if(!i)throw Error("Please define the MONGO_URI environment variable inside .env.local");if(n.connection)return n.connection;n.promise||(n.promise=a().connect(i,{bufferCommands:!1}));try{n.connection=await n.promise}catch(e){throw n.promise=void 0,e}return n.connection}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,969],()=>r(1465));module.exports=s})();